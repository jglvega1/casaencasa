"use strict";var socket;navigator.onLine&&(socket="localhost"==window.location.hostname?io.connect("localhost:8080",{forceNew:!0}):io.connect(window.location.hostname,{forceNew:!0})),"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js");var list=document.getElementById("list"),getLocalNdb=localStorage.getItem("ndb"),getLocalDb=localStorage.getItem("db"),db=[],nDb=[],subDb=[],notify=()=>{for(let t of subDb)t();if(navigator.onLine&&"[]"!==nDb)for(let t of nDb)socket.emit("updateData",t)},addSubDb=t=>{subDb.push(t)},setDataBase=t=>{setNdb(),db=[];for(var e=0;e<t.length;e++){db.push(t[e]);for(let t=0;t<nDb.length;t++)db[e].id==nDb[t].id&&db.splice(e,1,nDb[t]);db.sort((t,e)=>t.id-e.id)}notify()},updateMDB=()=>{if(navigator.onLine&&"[]"!==nDb)for(let t of nDb)socket.emit("updateData",t);countFRL=!1},setNdb=()=>{if(null!==getLocalNdb&&"[]"!==getLocalNdb)for(let t of JSON.parse(getLocalNdb))nDb.push(t);else localStorage.removeItem("ndb"),localStorage.setItem("ndb",JSON.stringify(nDb))},changeNdb=()=>{localStorage.removeItem("ndb"),localStorage.setItem("ndb",JSON.stringify(nDb)),updateMDB()},countFRL=!0,fristRenderList=()=>{countFRL&&renderList()};addSubDb(fristRenderList);var renderList=()=>{list.innerHTML="";var t=[];for(let e of db)0==t.includes(e.calle)&&t.push(e.calle);for(var e=0;e<t.length;e++){var a="r"+e;renderRoad(t[e],a)}},displayCards=(t,e)=>{for(let a of db)a.calle==t&&renderCard(a,document.getElementById(e))},renderCard=(t,e)=>{var a,n;0==t.estado?(n=`<h1>${t.casa}</h1>`,a=`<input type="checkbox" class="checkerHouses" onchange="chekedHouses(1, ${t.id})">`):1==t.estado?(n=`<h1>${t.casa}</h1>`,a=`<input type="checkbox" class="checkerHouses" onchange="chekedHouses(0, ${t.id})" checked>`):(n=`<h1 class="warning">${t.casa}</h1>`,a=`<input type="checkbox" class="checkerHouses" onchange="chekedHouses(0, ${t.id})" checked>`),e.innerHTML+=`\n\t\t\t\t<div class="card" id="${t.id}">\n\t\t\t\t\t<div id="casa">\n\t\t\t\t\t\t<p>Casa</p>\n\t\t\t\t\t\t${n}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div id="estado">\n\t\t\t\t\t\t<p>Estado</p>\n\t\t\t\t\t\t${a}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div id="btnSeeMore" onClick="SeeMore(${t.id})">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<div id="circle"></div>\n\t\t\t\t\t\t\t<div id="circle"></div>\n\t\t\t\t\t\t\t<div id="circle"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`},renderRoad=(t,e)=>{list.innerHTML+=`\n\t\t\t\t<div>\n\t\t\t\t\t<div class="card" id="header" onClick="funcRoad('${e}', '${t}')">\n\t\t\t\t\t\t<h1>${t}</h1>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="hosues" id="${e}"></div>\n\t\t\t\t</div>\n\t\t\t`},inNotas=document.querySelector(".notes"),marcar=document.querySelector("#marca"),btnSearch=document.getElementById("btnSearch"),inSearch=document.getElementById("inSearch"),SeeMore=t=>{for(let n of db)if(n.id==t){var e,a=n.notas;e=2==n.estado?`<input type="checkbox" id="${t}" onchange="chekedHouses(1, this.id)" checked>`:`<input type="checkbox" id="${t}" onchange="chekedHouses(2, this.id)">`,inNotas.value=a,inNotas.id=`${t}`,marcar.innerHTML=`\n\t\t\t\t\t\t<h1>Marcar</h1>\n\t\t\t\t\t\t${e}\n\t\t\t\t\t`}seeMore.style.left="0vw",list.style.left="100vw",collapseSearch(),inSearch.style.display="none",btnSearch.firstElementChild.setAttribute("class","cross-f"),btnSearch.lastElementChild.setAttribute("class","cross-s"),btnSearch.addEventListener("click",funcBtnCloseSeeMore)},funcNotes=t=>{for(let a of db){var e=0;if(a.id==t){for(let t of nDb)t.id==a.id&&(e=1);if(1==e)for(let t of nDb)t.id==a.id&&(t.notas=inNotas.value,changeNdb());else if(0==e){nDb.push(a);for(let t of nDb)t.id==a.id&&(t.notas=inNotas.value,changeNdb())}}}},cuad="",funcSearch=t=>{if(list.innerHTML="",closedRoads=[],"*"==t)renderList(),cuad="";else if(""!==cuad){let n=[];for(let e of db)0==n.includes(e.calle)&&e.cuadra===cuad&&e.casa===t&&n.push(e.calle);for(var e=0;e<n.length;e++){var a="r"+e;renderRoad(n[e],a);for(let d of db)d.calle==n[e]&&d.cuadra===cuad&&d.casa===t&&renderCard(d,document.getElementById(a))}}else{let e=[];for(let a of db)0==e.includes(a.calle)&&a.casa===t&&e.push(a.calle);for(var n=0;n<e.length;n++){let a="r"+n;renderRoad(e[n],a);for(let d of db)d.calle==e[n]&&d.casa===t&&renderCard(d,document.getElementById(a))}}},funcCuad=t=>{closedRoads=[],document.getElementById("list").innerHTML="",cuad=t.slice(1);var e=[];for(let t of db)0==e.includes(t.calle)&&t.cuadra===cuad&&e.push(t.calle);for(var a=0;a<e.length;a++){var n="r"+a;renderRoad(e[a],n)}funcUpdwn()};inSearch.addEventListener("keypress",t=>{13===(t.which||t.keyCode)&&funcSearch(inSearch.value)});var chekedHouses=(t,e)=>{var a=!1;for(let t of nDb)t.id==e&&(a=!0);if(a)for(var n=0;n<nDb.length;n++)nDb[n].id==e&&(nDb[n].estado=t,changeNdb());else{var d=db[e];d.estado=t,nDb.push(d),changeNdb()}};navigator.onLine?(socket.on("database",t=>{setDataBase(t),localStorage.setItem("db",JSON.stringify(db))}),socket.emit("queryDB"),socket.on("deleteNDB",t=>{for(var e=0;e<nDb.length;e++)if(nDb[e].id==t.id){nDb.splice(e,1);break}console.log(nDb),changeNdb()})):setDataBase(JSON.parse(getLocalDb));